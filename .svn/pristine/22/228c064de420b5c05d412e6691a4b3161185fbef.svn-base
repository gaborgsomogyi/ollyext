#include "stdafx.h"
#include "OllyExt.h"
#include "OptionsDialog.h"
#include "OllyExtVersion.h"
#include "OllyExtMenu.h"
#include "resource.h"


t_menu g_mainMenu[] =
{
	{ L"Options", L"Open Options window", K_NONE, menuOpenOptions, NULL, 0 },
	{ L"|About", L"About Bookmarks plugin", K_NONE, menuAbout, NULL, 0 },
	{ NULL, NULL, K_NONE, NULL, NULL, 0 }
};


int menuOpenOptions( t_table* pt, wchar_t* name, ulong index, int mode )
{
	if( mode == MENU_VERIFY )
	{
		return MENU_NORMAL;
	}
	else if( mode == MENU_EXECUTE )
	{
		DialogBoxParam( g_instance, MAKEINTRESOURCE( IDD_OPTIONS ), NULL, OptionsDlgProc, 0 );
		return MENU_NOREDRAW;
	}

	return MENU_ABSENT;
}


int menuAbout( t_table* pt, wchar_t* name, ulong index, int mode )
{
	wchar_t s[TEXTLEN];

	if( mode == MENU_VERIFY )
	{
		return MENU_NORMAL;
	}
	else if( mode == MENU_EXECUTE )
	{
	    Resumeallthreads();
		wsprintf( s, L"%ws\n%ws", g_versionStr, g_copyrightStr );
		MessageBox( hwollymain, s, PLUGIN_NAME, MB_OK | MB_ICONINFORMATION );
		Suspendallthreads();
		return MENU_NOREDRAW;
	}

	return MENU_ABSENT;
}
