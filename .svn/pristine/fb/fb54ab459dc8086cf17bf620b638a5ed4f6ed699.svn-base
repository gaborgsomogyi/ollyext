#include "stdafx.h"
#include "OllyExtLocal.h"


HMODULE localLoadLibrary( const wchar_t* libName )
{
	HMODULE hModule = LoadLibrary( libName );
	PLUGIN_CHECK_ERROR( hModule, return NULL;, UNABLE_TO_LOAD_MODULE, libName );
	return hModule;
}


HMODULE localGetModuleHandle( const wchar_t* libName )
{
	HMODULE hModule = GetModuleHandle( libName );
	PLUGIN_CHECK_ERROR( hModule, return NULL;, UNABLE_TO_FIND_MODULE, libName );
	return hModule;
}


FARPROC localGetProcAddress( const wchar_t* libName, const char* procName )
{
	HMODULE hModule = localLoadLibrary( libName );
	if( !hModule ) return NULL;

	FARPROC procAddress = GetProcAddress( hModule, procName );
	if( !procAddress )
	{
		wchar_t procNameW[TEXTLEN];
		Asciitounicode( procName, strlen( procName ), procNameW, TEXTLEN );
		PLUGIN_CHECK_ERROR( FALSE, return NULL;, UNABLE_TO_FIND_FUNCTION, libName, procNameW );
	}

	return procAddress;
}
