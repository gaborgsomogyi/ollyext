#include "stdafx.h"
#include "OllyExtOS.h"


static eOSType g_osType = OS_UNKNOWN;


void osInit( void )
{
	DWORD dwVersion = 0;
	DWORD dwMajorVersion = 0;
	DWORD dwMinorVersion = 0;
	DWORD dwBuild = 0;

	dwVersion = GetVersion();

	// Get the Windows version.
	dwMajorVersion = (DWORD)( LOBYTE( LOWORD( dwVersion ) ) );
	dwMinorVersion = (DWORD)( HIBYTE( LOWORD( dwVersion ) ) );

	// Get the build number.

	if( dwVersion < 0x80000000 )
		dwBuild = (DWORD)( HIWORD( dwVersion ) );

	Addtolist( 0, BLACK, L"Detected windows version: %d.%d (%d)",
                dwMajorVersion,
                dwMinorVersion,
                dwBuild );

	switch( dwMajorVersion )
	{
		case 5:
			g_osType = OS_XP;
		break;

		case 6:
			g_osType = OS_WIN7;
		break;

		default:
			g_osType = OS_UNKNOWN;
			MessageBox( NULL, INVALID_WIN_VERSION, PLUGIN_NAME, MB_OK | MB_ICONERROR );
		break;
	}
}


void osDestroy( void )
{
}


eOSType osGetType( void )
{
	return g_osType;
}
